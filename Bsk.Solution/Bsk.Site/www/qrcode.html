<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Fiadito</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/master.css">
</head>

<body id="branco">

    <div class="col col-sm-12 col-xs-12 logo">
        <center><img src="images/logo.png" class="img-responsive" alt=""></center>
        <input type="text" id="text" style="display: none;" value="1">
    </div>

    <div class="col col-sm-12 col-xs-12" id="qrcode">

        <div class="col col-sm-12 col-xs-12 tempo"><span id="pageBeginCountdownText">20</span> segundos</div>
    </div>


    <script src="js/jquery-3.2.1.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/qrcode.js"></script>
    <script src="js/master.js"></script>

    <script type="text/javascript">
        var jsonUser = window.localStorage.getItem("Usuario");
        var obj = JSON.parse(jsonUser);
        var idCliente = obj.Usuario[0].ChaveInterna;
        var contQrcode = $('#text').val();
        var x1 = Math.floor(Math.random() * 2518);
        var x2 = Math.floor(Math.random() * 9658);
        var idCliente = "Cliente1";
        var cpfCliente = "000.000.000-00";
        var token = x1 * x2;
        var result = cpfCliente + '-----' + idCliente + '-----' + token;
        document.getElementById("text").value = result;
        console.log(result);

        var qrcode = new QRCode(document.getElementById("qrcode"), {
            width: 100,
            height: 100
        });

        function makeCode() {
            var elText = document.getElementById("text");

            if (!elText.value) {
                alert("Input a text");
                elText.focus();
                return;
            }

            qrcode.makeCode(elText.value);
        }

        makeCode();

        $("#text").
        on("blur", function() {
            makeCode();
        }).
        on("keydown", function(e) {
            if (e.keyCode == 13) {
                makeCode();
            }
        });

        ProgressCountdown(20, 'pageBeginCountdown', 'pageBeginCountdownText');

        function ProgressCountdown(timeleft, bar, text) {
            return new Promise((resolve, reject) => {
                var countdownTimer = setInterval(() => {
                    timeleft--;

                    document.getElementById(text).textContent = timeleft;

                    if (timeleft <= 0) {
                        clearInterval(countdownTimer);
                        resolve(true);
                        window.location.href = 'pagar-com-fiadito.html'
                    }
                }, 1000);
            });
        }
    </script>
</body>

</html>