<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Fiadito</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/master.css">
</head>

<body id="roxo">

    <div class="col col-sm-12 col-xs-12 logo">
        <center><img src="images/logo.png" class="img-responsive" alt=""></center>
    </div>
    <div class="col col-sm-12 col-xs-12 formulario">
        <div class="col col-sm-12 col-xs-12">
            <input class="form-control cadastro-input" onblur="validaNome()" id="txtNome" type="text" placeholder="Nome Completo*">
            <span style="color:red;display:none;" id="msgNome">Campo obrigatório</span>
        </div>

        <div class="col col-sm-12 col-xs-12">&nbsp;</div>
        <div class="col col-sm-12 col-xs-12">&nbsp;</div>

        <div class="col col-sm-12 col-xs-12">
            <input class="form-control cadastro-input" onblur="validaEmail()" id="txtEmail" type="email" placeholder="E-mail*">
            <span style="color:red;display:none;" id="msgEmail">E-mail inválido</span>
        </div>

        <div class="col col-sm-12 col-xs-12">&nbsp;</div>
        <div class="col col-sm-12 col-xs-12">&nbsp;</div>

        <div class="col col-sm-12 col-xs-12">
            <input class="form-control cadastro-input cpf" onblur="validaCpf()" id="txtCpf" type="text" placeholder="CPF*">
            <span style="color:red;display:none;" id="msgCpf">Cpf inválido</span>
        </div>

        <div class="col col-sm-12 col-xs-12">&nbsp;</div>
        <div class="col col-sm-12 col-xs-12">&nbsp;</div>

        <div class="col col-sm-12 col-xs-12">
            <input class="form-control cadastro-input phone_with_ddd" onblur="validaTelefone()" id="txtTelefone" type="text" placeholder="Telefone*" />
            <span style="color:red;display:none;" id="msgTelefone">Telefone inválido</span>
        </div>
        <small>* Campos obrigatórios</small>

        <div class="col col-sm-12 col-xs-12">&nbsp;</div>
        <div class="col col-sm-12 col-xs-12">&nbsp;</div>

        <div class="col col-sm-12 col-xs-12">
            <button class="btn btn-app" id="btnEntrar" onclick="cadastrarFiadito()">Enviar</button>
        </div>
    </div>


    <script src="js/jquery-3.2.1.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/master.js"></script>
    <script src="js/jQuery-Mask-Plugin-master/src/jquery.mask.js"></script>
    <script src="js/comum.js"></script>
    <script type="text/javascript">
        function cadastrarFiadito() {
            var element = document.getElementById("btnEntrar");
            element.disabled = true;
            element.innerHTML = '<img src="images/loading.gif" height="20" />';
            var valida = validaCampos();
            if (valida) {
                var parametros = {
                    chave: chaveInserir,
                    Fiadito: $("#txtNome").val(),
                    Email: $("#txtEmail").val(),
                    Cpf: $("#txtCpf").val(),
                    Telefone: $("#txtTelefone").val()
                };
                comum.postAsync("Fiadito/InsereFiadito", parametros, validaCadastro)
            } else {
                var element = document.getElementById("btnEntrar");
                element.disabled = false;
                element.innerHTML = 'ENTRAR';
            }
        }

        function validaCadastro(data) {
            if (data.Mensagem!="Ok") {
                alert(data.Mensagem);
                var element = document.getElementById("btnEntrar");
                element.disabled = false;
                element.innerHTML = 'ENTRAR';
            } else {
                var user = '{ "Usuario" : [{ "Nome":"' + data.Result.Fiadito + '" , "Id":"' + data.Result.IdFiadito + '", "Email":"' + data.Result.Email + '", "Telefone":"' + data.Result.Telefone + '", "Cpf":"' + data.Result.Cpf + '", "ChaveInterna":"' + data.Result.ChaveInterna + '" }]}';
                window.localStorage.setItem("Usuario", user);
                window.location.replace("index.html");
            }
        }

        function validaCampos() {
            var valida = true;
            if ($("#txtNome").val() == "") {
                valida = false;
                $("#msgNome").show();
            } else {
                $("#msgNome").hide();
            }

            if ($("#txtEmail").val() == "") {
                valida = false;
                $("#msgEmail").show();
            } else {
                valida = validaEmail();
            }

            if ($("#txtCpf").val() == "") {
                valida = false;
                $("#msgCpf").show();
            } else {
                valida = validaCpf();
            }

            if ($("#txtTelefone").val() == "") {
                valida = false;
                $("#msgTelefone").show();
            } else {
                valida = validaTelefone();
            }
            return valida;
        }

        function validaNome() {
            if ($("#txtNome").val() == "") {
                $("#msgNome").show();
            } else {
                $("#msgNome").hide();
            }
        }

        function validaEmail() {
            var valida = true;
            var usuario = $("#txtEmail").val().substring(0, $("#txtEmail").val().indexOf("@"));
            var dominio = $("#txtEmail").val().substring($("#txtEmail").val().indexOf("@") + 1, $("#txtEmail").val().length);

            if ((usuario.length >= 1) &&
                (dominio.length >= 3) &&
                (usuario.search("@") == -1) &&
                (dominio.search("@") == -1) &&
                (usuario.search(" ") == -1) &&
                (dominio.search(" ") == -1) &&
                (dominio.search(".") != -1) &&
                (dominio.indexOf(".") >= 1) &&
                (dominio.lastIndexOf(".") < dominio.length - 1)) {
                $("#msgEmail").hide();
            }
            else {
                valida = false;
                $("#msgEmail").show();
            }
            return valida;
        }

        function validaCpf() {
            var valida = true;
            var cpf = $("#txtCpf").val();
            cpf = cpf.replace(/[^\d]+/g, '');
            if (cpf == '') {
                valida = false;
            }
            // Elimina CPFs invalidos conhecidos
            if (cpf.length != 11 ||
                cpf == "00000000000" ||
                cpf == "11111111111" ||
                cpf == "22222222222" ||
                cpf == "33333333333" ||
                cpf == "44444444444" ||
                cpf == "55555555555" ||
                cpf == "66666666666" ||
                cpf == "77777777777" ||
                cpf == "88888888888" ||
                cpf == "99999999999") {
                valida = false;
            }
            // Valida 1o digito
            add = 0;
            for (i = 0; i < 9; i++)
                add += parseInt(cpf.charAt(i)) * (10 - i);
            rev = 11 - (add % 11);
            if (rev == 10 || rev == 11)
                rev = 0;
            if (rev != parseInt(cpf.charAt(9))) {
                valida = false;
            }
            // Valida 2o digito
            add = 0;
            for (i = 0; i < 10; i++)
                add += parseInt(cpf.charAt(i)) * (11 - i);
            rev = 11 - (add % 11);
            if (rev == 10 || rev == 11)
                rev = 0;
            if (rev != parseInt(cpf.charAt(10))) {
                valida = false;
            }

            if (!valida) {
                $("#msgCpf").show();
            } else {
                $("#msgCpf").hide();
            }
            return valida;
        }

        function validaTelefone() {
            var valida = true;
            if ($("#txtTelefone").val().length < 14) {
                $("#msgTelefone").show();
                valida = false;
            } else {
                $("#msgTelefone").hide();
            }
            return valida;
        }

        $(document).ready(function () {
            $('.phone_with_ddd').mask('(00) 00000-0000');
            $('.cpf').mask('000.000.000-00', { reverse: true });
        });
    </script>
</body>

</html>